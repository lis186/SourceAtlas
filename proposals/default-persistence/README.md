# Proposal: é»˜èªå­˜å„² + è‡ªå‹•ä¸²æ¥

**Status**: ğŸ”µ å¾…è©•ä¼°
**Version**: 1.0
**Author**: Claude & Justin
**Created**: 2026-01-02
**Based on**: [persistence proposal](../persistence/README.md) (v2.9.1)

---

## èƒŒæ™¯

### ä¾†æº

2026-01-02 ç¤¾ç¾¤è¨è«–æ–‡ç« åˆ†æï¼Œæ¢è¨ MCP vs Skills çš„æŠ€è¡“é¸æ“‡ã€‚

æ ¸å¿ƒæ´è¦‹ï¼š**Skills é€éç¡¬ç¢Ÿæš«å­˜ + è¼•é‡ç›®éŒ„è¼‰å…¥ï¼Œå¤§å¹…æ¸›å°‘ context ä½”ç”¨**

```
MCP: å•Ÿå‹•è¼‰å…¥å…¨éƒ¨è¦æ ¼ â†’ æ¯æ¬¡æ“ä½œéƒ½è¿”å›è³‡æ–™ä½”ç”¨ context
Skills: éœ€è¦æ™‚æ‰è¼‰å…¥ â†’ çµæœå­˜ç¡¬ç¢Ÿ â†’ æœ€çµ‚æ‰è¿”å›ç²¾ç°¡çµæœ
```

### ç¾æ³å•é¡Œ

ç›®å‰ SourceAtlas çš„ `--save` æ˜¯ **opt-in** è¨­è¨ˆï¼š

```bash
/atlas.overview          # ä¸å­˜
/atlas.overview --save   # å­˜
```

å•é¡Œï¼š
1. **ç”¨æˆ¶è¦è¨˜å¾—åŠ  `--save`** - å¿˜äº†å°±æµªè²»äº†
2. **è·¨ skill ä¸²æ¥è¦æ‰‹å‹•** - ç„¡æ³•è‡ªå‹•åˆ©ç”¨å‰æ¬¡çµæœ
3. **é•å Skills ç†å¿µ** - æ‡‰è©²é è¨­å­˜ç¡¬ç¢Ÿ

---

## è§£æ±ºæ–¹æ¡ˆ

### æ ¸å¿ƒè®Šæ›´ï¼šé»˜èªå­˜å„²

å¾ **opt-in** æ”¹ç‚º **opt-out**ï¼š

| ç¾æ³ | æ”¹å¾Œ |
|-----|------|
| `/atlas.overview` ä¸å­˜ | `/atlas.overview` è‡ªå‹•å­˜ |
| `/atlas.overview --save` å­˜ | ç§»é™¤ `--save` åƒæ•¸ |
| ç„¡ | `/atlas.overview --force` è·³é cache |

### æ–°çš„åƒæ•¸è¨­è¨ˆ

```bash
/atlas.overview          # è‡ªå‹•å­˜åˆ° .sourceatlas/overview.yaml
/atlas.overview --force  # è·³é cacheï¼Œå¼·åˆ¶é‡æ–°åˆ†æ
/atlas.clear             # æ¸…é™¤æ‰€æœ‰ cache
```

è¨­è¨ˆåŸå‰‡ï¼š
- **å­˜æ˜¯å¸¸æ…‹** â†’ ä¸ç”¨åƒæ•¸
- **ä¸å­˜æ˜¯ä¾‹å¤–** â†’ ç”¨ `--force`

---

## è©³ç´°è¨­è¨ˆ

### 1. è¡Œç‚ºçŸ©é™£ï¼ˆç°¡åŒ–ç‰ˆï¼‰

| å¿«å–å­˜åœ¨ | `--force` | è¡Œç‚º |
|---------|-----------|------|
| âŒ | - | åˆ†æ + **è‡ªå‹•å­˜å„²** |
| âœ… | âŒ | ç›´æ¥è¼‰å…¥å¿«å– |
| âœ… | âœ… | é‡æ–°åˆ†æ + è¦†è“‹å¿«å– |

å°æ¯”åŸè¨­è¨ˆï¼š

| å¿«å–å­˜åœ¨ | `--force` | `--save` | åŸè¡Œç‚º |
|---------|-----------|----------|------|
| âŒ | - | âŒ | æ­£å¸¸åˆ†æï¼ˆä¸å­˜ï¼‰ |
| âŒ | - | âœ… | åˆ†æ + å„²å­˜ |
| âœ… | âŒ | - | ç›´æ¥è¼‰å…¥å¿«å– |
| âœ… | âœ… | âŒ | é‡æ–°åˆ†æï¼ˆä¸è¦†è“‹ï¼‰ |
| âœ… | âœ… | âœ… | é‡æ–°åˆ†æ + è¦†è“‹ |

ç°¡åŒ–å¾Œåªæœ‰ 3 ç¨®ç‹€æ…‹ï¼ŒèªçŸ¥è² æ“”å¤§å¹…é™ä½ã€‚

### 2. è‡ªå‹•ä¸²æ¥é‚è¼¯

```yaml
/atlas.pattern åŸ·è¡Œæ™‚:
  1. æª¢æŸ¥ .sourceatlas/overview.yaml
  2. å¦‚å­˜åœ¨ä¸”æœªéæœŸ â†’ è®€å–ä½œç‚º context
  3. å¦‚ä¸å­˜åœ¨ â†’ å…ˆåŸ·è¡Œè¼•é‡ overview
  4. çµæœå­˜ .sourceatlas/pattern.yaml

/atlas.flow åŸ·è¡Œæ™‚:
  1. æª¢æŸ¥ overview.yaml + pattern.yaml
  2. åˆ©ç”¨å·²æœ‰ context
  3. çµæœå­˜ .sourceatlas/flow-{mode}.yaml
```

### 3. Skill é–“çš„è³‡æ–™ä¾è³´åœ–

```
/atlas.overview â”€â”€â”¬â”€â”€â†’ /atlas.pattern (åˆ©ç”¨ overview çš„æ¶æ§‹ context)
                  â”œâ”€â”€â†’ /atlas.flow    (åˆ©ç”¨ overview çš„ entry points)
                  â”œâ”€â”€â†’ /atlas.deps    (åˆ©ç”¨ overview çš„ dependencies)
                  â””â”€â”€â†’ /atlas.history (åˆ©ç”¨ overview çš„ key files)

/atlas.pattern â”€â”€â”€â”¬â”€â”€â†’ /atlas.impact  (åˆ©ç”¨æ¶æ§‹ç†è§£)
/atlas.flow â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Cache éæœŸç­–ç•¥

```yaml
éæœŸæ¢ä»¶:
  - git HEAD è®Šæ›´ï¼ˆæœ‰æ–° commitï¼‰
  - é—œéµæª”æ¡ˆä¿®æ”¹æ™‚é–“ > cache æ™‚é–“
  - ç”¨æˆ¶æŒ‡å®š --force

éæœŸæ™‚é¡¯ç¤º:
  âš ï¸ å¿«å–å·²éæœŸï¼ˆ30 å¤©å‰ï¼‰ï¼Œå»ºè­°ä½¿ç”¨ --force é‡æ–°åˆ†æ
```

---

## éœ€ä¿®æ”¹çš„æª”æ¡ˆ

### Commandsï¼ˆ6 å€‹ï¼‰

```
plugin/commands/
â”œâ”€â”€ overview.md    # ç§»é™¤ --saveï¼ŒåŠ å…¥è‡ªå‹•å­˜å„²é‚è¼¯
â”œâ”€â”€ pattern.md     # åŒä¸Š + è‡ªå‹•è®€ overview cache
â”œâ”€â”€ flow.md        # åŒä¸Š + è‡ªå‹•è®€ overview/pattern cache
â”œâ”€â”€ history.md     # åŒä¸Š
â”œâ”€â”€ impact.md      # åŒä¸Š + è‡ªå‹•è®€ flow cache
â””â”€â”€ deps.md        # åŒä¸Š
```

### Skillsï¼ˆå°æ‡‰ä¿®æ”¹ï¼‰

```
plugin/skills/
â”œâ”€â”€ overview.md
â”œâ”€â”€ pattern.md
â”œâ”€â”€ flow.md
â”œâ”€â”€ history.md
â”œâ”€â”€ impact.md
â””â”€â”€ deps.md
```

### æ–‡æª”

```
â”œâ”€â”€ USAGE_GUIDE.md      # æ›´æ–°åƒæ•¸èªªæ˜
â”œâ”€â”€ CLAUDE.md           # æ›´æ–°å‘½ä»¤æ¸…å–®
â””â”€â”€ plugin/plugin.json  # æ›´æ–° skill æè¿°
```

---

## Prompt ä¿®æ”¹ç¯„ä¾‹

### åŸç‰ˆï¼ˆ`--save` opt-inï¼‰

```markdown
## Save Mode (--save)

If `--save` is in arguments:
1. Save to .sourceatlas/...
2. Confirm: ğŸ’¾ å·²å„²å­˜è‡³ ...
```

### æ–°ç‰ˆï¼ˆé»˜èªå­˜å„²ï¼‰

```markdown
## è‡ªå‹•å­˜å„²ï¼ˆé»˜èªè¡Œç‚ºï¼‰

åˆ†æå®Œæˆå¾Œï¼š
1. ç¢ºä¿ç›®éŒ„å­˜åœ¨ï¼š`mkdir -p .sourceatlas/`
2. å„²å­˜çµæœè‡³å°æ‡‰è·¯å¾‘
3. é¡¯ç¤ºï¼šğŸ’¾ å·²å„²å­˜è‡³ .sourceatlas/overview.yaml

## Cache ä¸²æ¥ï¼ˆåˆ†æå‰æª¢æŸ¥ï¼‰

**å¦‚æœæ²’æœ‰ `--force`**ï¼š

1. æª¢æŸ¥ç›¸é—œ cache æ˜¯å¦å­˜åœ¨ï¼š
   - æœ¬å‘½ä»¤çš„ cacheï¼ˆå¦‚ overview.yamlï¼‰
   - ä¸Šæ¸¸ cacheï¼ˆå¦‚ pattern éœ€è¦ overviewï¼‰

2. å¦‚æœæœ¬å‘½ä»¤ cache å­˜åœ¨ï¼š
   - è®€å–ä¸¦é¡¯ç¤ºï¼šğŸ“ è¼‰å…¥å¿«å–ï¼š.sourceatlas/overview.yamlï¼ˆ3 å¤©å‰ï¼‰
   - çµæŸï¼Œä¸åŸ·è¡Œåˆ†æ

3. å¦‚æœä¸Šæ¸¸ cache å­˜åœ¨ï¼š
   - è®€å–ä½œç‚º contextï¼Œæ¸›å°‘åˆ†ææ™‚é–“

**å¦‚æœæœ‰ `--force`**ï¼š
- è·³é cache æª¢æŸ¥
- å¼·åˆ¶é‡æ–°åˆ†æ
- è¦†è“‹èˆŠ cache
```

---

## å¯¦ä½œè¨ˆç•«

| æ­¥é©Ÿ | é …ç›® | èªªæ˜ |
|-----|------|------|
| 1 | ä¿®æ”¹ overview.md | ç§»é™¤ --saveï¼ŒåŠ å…¥è‡ªå‹•å­˜å„² |
| 2 | æ¸¬è©¦ overview | ç¢ºèªé»˜èªå­˜å„²æ­£å¸¸ |
| 3 | ä¿®æ”¹å…¶ä»– 5 å€‹å‘½ä»¤ | pattern, flow, history, impact, deps |
| 4 | åŠ å…¥è‡ªå‹•ä¸²æ¥é‚è¼¯ | pattern è®€ overview cache |
| 5 | æ›´æ–°æ–‡æª” | USAGE_GUIDE, CLAUDE.md |
| 6 | æ¸¬è©¦ä¸²æ¥ | é©—è­‰è·¨ skill è³‡æ–™æµ |

---

## é©—æ”¶æ¨™æº–

- [ ] 6 å€‹å‘½ä»¤é»˜èªå­˜å„²åˆ° `.sourceatlas/`
- [ ] `--save` åƒæ•¸å·²ç§»é™¤
- [ ] `--force` å¯è·³é cache ä¸¦è¦†è“‹
- [ ] `/atlas.pattern` è‡ªå‹•åˆ©ç”¨ overview cache
- [ ] `/atlas.flow` è‡ªå‹•åˆ©ç”¨ overview + pattern cache
- [ ] æ–‡æª”å·²æ›´æ–°
- [ ] ç”¨æˆ¶é«”é©—æ¸¬è©¦é€šé

---

## é¢¨éšªè©•ä¼°

| é¢¨éšª | å½±éŸ¿ | ç·©è§£ |
|------|------|------|
| ç”¨æˆ¶ç¿’æ…£ `--save` | ä½ | é¡¯ç¤º deprecation æç¤º |
| cache ç´¯ç©éå¤š | ä½ | `/atlas.clear` å·²å­˜åœ¨ |
| è‡ªå‹•ä¸²æ¥å¤±æ•— | ä¸­ | é™ç´šç‚ºç¨ç«‹åˆ†æ |

---

## é æœŸæ•ˆæœ

### ç”¨æˆ¶é«”é©—

```bash
# ç°¡å–®ç›´è¦º
/atlas.overview        # è‡ªå‹•å­˜
/atlas.pattern         # è‡ªå‹•è®€ overviewï¼Œè‡ªå‹•å­˜
/atlas.flow entry      # è‡ªå‹•è®€ overview+patternï¼Œè‡ªå‹•å­˜

# éœ€è¦æ™‚
/atlas.overview --force  # å¼·åˆ¶é‡æ–°åˆ†æ
/atlas.clear             # æ¸…é™¤æ‰€æœ‰ cache
```

### æ•ˆç›Š

1. **æ¸›å°‘èªçŸ¥è² æ“”** - ä¸ç”¨è¨˜å¾—åŠ  `--save`
2. **è‡ªå‹•ä¸²æ¥** - è·¨ skill è³‡æ–™æµè‡ªå‹•ç”Ÿæ•ˆ
3. **ç¬¦åˆ Skills ç†å¿µ** - ç¡¬ç¢Ÿæš«å­˜ç‚ºé»˜èªè¡Œç‚º
4. **æ¸›å°‘ context ä½”ç”¨** - ä¸­é–“çµæœä¸ä½”ç”¨å°è©± context

---

## æ¶æ§‹å¸«å¯©æŸ¥æ„è¦‹ï¼ˆGemini Reviewï¼‰

**å¯©æŸ¥æ—¥æœŸ**: 2026-01-02

### å„ªé»

1. **é¡¯è‘—é™ä½ä½¿ç”¨è€…èªçŸ¥è² æ“”** - å°‡ã€Œå„²å­˜ã€ä½œç‚ºé è¨­è¡Œç‚ºï¼Œç¬¦åˆã€Œç´„å®šå„ªæ–¼é…ç½®ã€åŸå‰‡
2. **è‡ªå‹•åŒ–å·¥ä½œæµç¨‹ä¸²æ¥** - å¾ã€Œå–®ä¸€å·¥å…·ã€é‚å‘ã€Œæ™ºæ…§åŠ©ç†ã€çš„é—œéµä¸€æ­¥
3. **æå‡åŸ·è¡Œæ•ˆç‡èˆ‡æ¸›å°‘ Context æ¶ˆè€—** - åˆ©ç”¨ç£ç¢Ÿä½œç‚ºä¸­é–“ç‹€æ…‹æš«å­˜å€
4. **ç¬¦åˆ Skills å°å‘çš„è¨­è¨ˆå“²å­¸** - ç¢ºä¿æœªä¾†æ“´å±•æ€§å’Œå¯ç¶­è­·æ€§
5. **ç°¡åŒ–æŒ‡ä»¤ä»‹é¢** - ç§»é™¤ `--save`ï¼Œåªä¿ç•™ `--force` ä½œç‚ºä¾‹å¤–æ§åˆ¶

### æ½›åœ¨å•é¡Œ

1. **å¿«å–å¤±æ•ˆç­–ç•¥çš„ç²¾ç¢ºæ€§**
   - æœªæäº¤çš„è®Šæ›´ (unstaged/staged changes) æ€éº¼è¾¦ï¼Ÿ
   - ã€Œé—œéµæª”æ¡ˆã€å¦‚ä½•å®šç¾©ï¼Ÿ

2. **å¿«å–ç‹€æ…‹çš„é€æ˜åº¦èˆ‡å¯è¿½æº¯æ€§**
   - ç•¶ `/atlas.flow` è‡ªå‹•è¼‰å…¥å¤šå€‹ cache æ™‚ï¼Œä½¿ç”¨è€…å¦‚ä½•çŸ¥é“æ˜¯åŸºæ–¼å“ªå€‹ç‰ˆæœ¬ï¼Ÿ
   - ä¸åŒ cache çš„æ™‚é–“æˆ³ä¸ä¸€è‡´æ™‚ï¼Œå¦‚ä½•è™•ç†ï¼Ÿ

3. **éš±æ€§çš„è³‡æ–™ä¾è³´ç®¡ç†**
   - skill ä¹‹é–“çš„ä¾è³´é—œä¿‚æ˜¯ã€Œéš±æ€§ã€çš„ï¼Œåˆ†æ•£åœ¨å„å€‹ prompt ä¸­
   - æœªä¾† skill æ•¸é‡å¢åŠ æ™‚ï¼Œä¾è³´åœ–æœƒè®Šå¾—è¤‡é›œ

4. **éŒ¯èª¤è™•ç†èˆ‡é™ç´šæ©Ÿåˆ¶**
   - cache æª”æ¡ˆæ¯€ææˆ–æ ¼å¼ä¸æ­£ç¢ºæ™‚çš„è™•ç†ï¼Ÿ

### æ”¹é€²å»ºè­°

#### 1. å¼·åŒ–å¿«å–å¤±æ•ˆé‚è¼¯

```bash
# é™¤äº† git HEADï¼Œå¢åŠ å° git status çš„æª¢æŸ¥
git status --porcelain
# å¦‚æœæœ‰æœªæäº¤è®Šæ›´ï¼Œæç¤ºï¼š
# âš ï¸ åµæ¸¬åˆ°æœªæäº¤çš„è®Šæ›´ï¼Œå¿«å–å¯èƒ½å·²éæœŸï¼Œå»ºè­°å…ˆæäº¤æˆ–ä½¿ç”¨ --force
```

åœ¨ cache æª”æ¡ˆä¸­åŠ å…¥ metadataï¼š
```yaml
_metadata:
  git_commit: a1b2c3d
  created_at: 2026-01-02T10:30:00Z
  command: /atlas.overview
```

#### 2. å»ºç«‹å¿«å–ä¾è³´éˆæ—¥èªŒ

å»ºç«‹ `.sourceatlas/manifest.json`ï¼š
```json
{
  "last_run": {
    "command": "/atlas.flow entry",
    "output": "flow-entry.yaml",
    "dependencies": [
      {"file": "overview.yaml", "commit": "a1b2c3d", "age": "3 days"},
      {"file": "pattern.yaml", "commit": "a1b2c3d", "age": "1 day"}
    ]
  }
}
```

è¼‰å…¥æ™‚é¡¯ç¤ºï¼š
```
ğŸ“ è¼‰å…¥å¿«å– flow-entry.yaml (åŸºæ–¼ 3 å¤©å‰çš„ overview èˆ‡ 1 å¤©å‰çš„ pattern)
```

#### 3. å°‡ä¾è³´é—œä¿‚é¡¯æ€§åŒ–

å»ºç«‹ `.sourceatlas/dependencies.yaml`ï¼š
```yaml
pattern:
  - overview
flow:
  - overview
  - pattern
impact:
  - pattern
  - flow
```

#### 4. å®šç¾©éŒ¯èª¤è™•ç†èˆ‡è‡ªå‹•é™ç´š

```
è‹¥ overview.yaml è®€å–å¤±æ•—ï¼š
1. âŒ è®€å– overview.yaml å¿«å–å¤±æ•—ï¼Œæª”æ¡ˆå¯èƒ½å·²ææ¯€
2. å°‡ç‚ºæ‚¨é‡æ–°åŸ·è¡Œè¼•é‡åˆ†æ...
3. è‡ªå‹•è§¸ç™¼ /atlas.overviewï¼Œç„¶å¾Œç¹¼çºŒåŸä»»å‹™
```

### å¯©æŸ¥çµè«–

> **å¼·çƒˆæ¨è–¦æ¡ç´æ­¤ææ¡ˆ**ï¼Œä¸¦åœ¨å¯¦ä½œéç¨‹ä¸­æ•´åˆä¸Šè¿°æ”¹é€²å»ºè­°ã€‚
> ä¸»è¦è‘—çœ¼æ–¼**å°‡éš±æ€§è¦å‰‡é¡¯æ€§åŒ–**ã€**å¢å¼·ç³»çµ±çš„å¥å£¯æ€§**èˆ‡**é•·æœŸå¯ç¶­è­·æ€§**ã€‚

---

## å›æ‡‰èˆ‡æ±ºç­–

é‡å°å¯©æŸ¥æ„è¦‹çš„å›æ‡‰ï¼š

| å»ºè­° | æ±ºç­– | ç†ç”± |
|------|------|------|
| git status æª¢æŸ¥ | âœ… æ¡ç´ | å¯¦ç”¨ï¼Œå¯¦ä½œç°¡å–® |
| metadata è¨˜éŒ„ | âœ… æ¡ç´ | å·²åœ¨ /atlas.list æœ‰é¡ä¼¼æ¦‚å¿µ |
| manifest.json | âšª å»¶å¾Œ | Phase 2 è§€å¯Ÿéœ€æ±‚ |
| dependencies.yaml | âšª å»¶å¾Œ | ç›®å‰ 6 å€‹ skill é‚„å¯ç®¡ç† |
| éŒ¯èª¤é™ç´š | âœ… æ¡ç´ | å¿…è¦çš„å¥å£¯æ€§ |

---

## ç›¸é—œè³‡æº

- [MCP vs Skills åˆ†æ](../../ideas/mcp-vs-skills-analysis.md)
- [persistence proposal](../persistence/README.md)
- [Anthropic: Code execution with MCP](https://www.anthropic.com/engineering/code-execution-with-mcp)
- [Agent Skills æ¨™æº–](https://agentskills.io/specification)
