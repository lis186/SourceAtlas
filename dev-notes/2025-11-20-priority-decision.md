# 功能優先級決策 - 2025-11-20

## 📌 Justin 的優先級排序

### 明確的優先順序

1. **學習現有設計模式** ⭐⭐⭐⭐⭐
2. **某個功能改動的影響範圍** ⭐⭐⭐⭐
3. **API 改動影響範圍** ⭐⭐⭐
4. **Bug 修復** ⭐⭐
5. **Code Review** ⭐

---

## 💡 優先級背後的洞察

### 為什麼「學習模式」最優先？

這個排序透露了幾個關鍵信息：

#### 1. 預防性 > 反應性

```
傳統開發者思維：
  遇到 Bug → 修 Bug → 下一個 Bug

成熟開發者思維：
  學習模式 → 理解架構 → 正確實作 → 減少 Bug
```

**Justin 的優先級反映**：
- ✅ 先理解「怎麼做」（學習模式）
- ✅ 再評估「影響什麼」（影響範圍）
- ⏸️ 最後才處理「修什麼」（Bug 修復）

#### 2. 維護既有專案 > 從零開始

如果是從零開始的專案：
- 不需要「學習現有模式」
- 不需要「評估影響範圍」
- 直接寫新代碼即可

**Justin 的需求暗示**：
- 經常接手既有專案
- 需要快速理解現有架構
- 需要遵循現有慣例
- 需要評估變更風險

#### 3. 降低認知負擔 > 快速解決問題

```
低優先級：Bug 修復（反應性，壓力大）
高優先級：學習模式（主動性，建立理解）
```

**心理模型**：
- 「我不想每次都猜該怎麼做」
- 「我想先理解這個專案的做法」
- 「然後按照慣例正確實作」
- 「而不是亂改然後製造新 Bug」

---

## 🎯 場景優先級調整

### 原始假設（我的排序）

| 場景 | 假設優先級 | 理由 |
|------|----------|------|
| Bug 修復 | ⭐⭐⭐⭐⭐ | 緊急、高頻 |
| API 影響 | ⭐⭐⭐⭐ | 高風險 |
| 學習模式 | ⭐⭐⭐ | 重要但不緊急 |
| Code Review | ⭐⭐ | 輔助功能 |

### 實際需求（Justin 的排序）

| 場景 | 實際優先級 | 使用情境 |
|------|----------|---------|
| **學習設計模式** | ⭐⭐⭐⭐⭐ | 接手專案、新增功能、理解架構 |
| **功能改動影響** | ⭐⭐⭐⭐ | 重構、修改現有功能 |
| **API 改動影響** | ⭐⭐⭐ | API 演進、前後端協作 |
| **Bug 修復** | ⭐⭐ | 被動處理 |
| **Code Review** | ⭐ | 輔助功能 |

---

## 📋 調整後的開發計劃

### v2.5 核心功能（按優先級）

#### Priority 1: `/atlas pattern` - 學習設計模式 ⭐⭐⭐⭐⭐

**目標**：快速學習專案的設計模式和慣例

**使用場景**：
```bash
# 場景 1：我要新增一個 API 端點
/atlas pattern "api endpoint"

# 場景 2：我要新增背景任務
/atlas pattern "background job"

# 場景 3：我要處理檔案上傳
/atlas pattern "file upload"

# 場景 4：我要實作權限檢查
/atlas pattern "authorization"
```

**AI 應該回答**：
1. ✅ 這個專案怎麼處理這類需求？
2. ✅ 最佳範例檔案在哪？
3. ✅ 標準流程是什麼？
4. ✅ 需要遵循哪些慣例？
5. ✅ 常見陷阱有哪些？

**技術實作**：
```bash
# Script 負責
- grep 找關鍵字（"controller", "job", "upload"）
- find 找相關檔案模式
- 列出最近修改的相關檔案

# AI 負責
- 理解查詢意圖
- 識別最佳範例
- 提取設計模式
- 說明慣例和步驟
- 提供完整工作流程
```

---

#### Priority 2: `/atlas impact` - 功能改動影響範圍 ⭐⭐⭐⭐

**目標**：評估某個功能改動會影響哪些地方

**使用場景**：
```bash
# 場景 1：我要改 User 登入邏輯
/atlas impact "user authentication"

# 場景 2：我要改訂單計算方式
/atlas impact "order calculation"

# 場景 3：我要改權限系統
/atlas impact "permission system"
```

**AI 應該回答**：
1. ✅ 這個功能在哪些地方被使用？
2. ✅ 直接依賴有哪些？
3. ✅ 間接影響有哪些？
4. ✅ 哪些測試會受影響？
5. ✅ 風險等級評估

**技術實作**：
```bash
# Script 負責
- grep 找功能關鍵字
- 找相關檔案和呼叫處
- git log 找歷史變更

# AI 負責
- 理解功能範圍
- 追蹤依賴鏈
- 評估影響程度
- 給出修改建議
```

---

#### Priority 3: `/atlas impact api` - API 改動影響範圍 ⭐⭐⭐

**目標**：評估 API 改動會影響哪些前端頁面/元件

**使用場景**：
```bash
# 場景：後端要改 User API
/atlas impact api "/api/users/{id}"
```

**AI 應該回答**：
1. ✅ 哪些 Hook/Service 呼叫這個 API？
2. ✅ 哪些元件使用這些 Hook？
3. ✅ 哪些欄位被使用？如何使用？
4. ✅ 哪些測試需要更新？
5. ✅ 遷移檢查清單

---

#### Priority 4: `/atlas find` - Bug 快速定位 ⭐⭐

**目標**：快速找到某個功能的實作位置

**使用場景**：
```bash
# 場景：用戶回報登入有問題
/atlas find "user login"
```

**AI 應該回答**：
1. ✅ 功能在哪個檔案？
2. ✅ 主要邏輯在哪幾行？
3. ✅ 相關測試在哪？
4. ✅ 最近的變更記錄

---

#### Priority 5: `/atlas review` - Code Review 輔助 ⭐

**目標**：理解 PR 的變更意圖和影響

（優先級最低，可能延後到 v2.6 或 v3.0）

---

## 🏗️ 實作順序建議

### Phase 1: 核心 Skill 框架（Week 1）
- [ ] 設計 `.claude/skills/atlas.md` 基礎架構
- [ ] 實作 `/atlas` (Stage 0)
- [ ] 基礎 Scripts（detect-project-type, scan-high-entropy）

### Phase 2: Priority 1 - 學習模式（Week 1-2）⭐⭐⭐⭐⭐
- [ ] 實作 `/atlas pattern` 命令
- [ ] Script: 找範例檔案
- [ ] AI Prompt: 識別設計模式
- [ ] 測試：在真實專案驗證
- [ ] 優化：改進模式識別邏輯

### Phase 3: Priority 2 - 功能影響（Week 2）⭐⭐⭐⭐
- [ ] 實作 `/atlas impact` 命令
- [ ] Script: 找依賴關係
- [ ] AI Prompt: 追蹤影響範圍
- [ ] 測試：驗證準確度

### Phase 4: Priority 3 - API 影響（Week 2-3）⭐⭐⭐
- [ ] 實作 `/atlas impact api` 命令
- [ ] Script: 找 API 調用
- [ ] AI Prompt: 分析欄位使用
- [ ] 測試：前後端分離專案

### Phase 5: Priority 4 - Bug 定位（Week 3）⭐⭐
- [ ] 實作 `/atlas find` 命令
- [ ] 整合搜尋邏輯
- [ ] 測試：常見 Bug 場景

### Phase 6: 優化與文檔（Week 3-4）
- [ ] 整體測試和優化
- [ ] 使用文檔
- [ ] 收集回饋

---

## 💭 為什麼這個優先級很合理

### 1. 符合真實工作流程

**典型的開發流程**：
```
1. 接到新任務（新增功能 X）
2. ❓ 這個專案怎麼處理類似功能的？ → /atlas pattern
3. 🔍 找到範例，理解模式
4. 💻 按照模式實作
5. ⚠️ 改動會影響什麼？ → /atlas impact
6. 🧪 評估風險，補測試
7. ✅ 完成開發
```

**不是**：
```
1. 遇到 Bug
2. 瞎猜在哪
3. 亂改
4. 製造新 Bug
5. 繼續修
```

### 2. 減少技術債務

**學習模式優先的好處**：
- ✅ 新代碼符合現有架構
- ✅ 減少不一致性
- ✅ 降低維護成本
- ✅ 團隊協作更順暢

### 3. 提升開發信心

**心理層面**：
```
有模式可學 → 知道怎麼做 → 有信心實作 → 代碼品質高
vs
不知道怎麼做 → 瞎猜瞎試 → 沒有信心 → 代碼品質差
```

---

## 📊 與 PRD 的對照

### PRD 原始場景順序（我設計的）

1. Bug 修復
2. 學習模式
3. 影響分析
4. Code Review
5. 技術債務

### 調整後的順序（基於 Justin 需求）

1. **學習設計模式** ← 從第2調到第1
2. **功能改動影響** ← 從第3拆分並提升
3. **API 改動影響** ← 從第3拆分
4. **Bug 修復** ← 從第1降到第4
5. **Code Review** ← 維持第4（現在第5）

---

## 🎯 關鍵決策

### 決定：優先實作 `/atlas pattern`

**理由**：
1. ✅ Justin 明確表示最優先
2. ✅ 符合實際工作流程
3. ✅ 展示 SourceAtlas 核心價值
4. ✅ 技術上相對容易實作
5. ✅ 立即可用，價值明顯

### 決定：影響分析分為兩類

**功能改動影響** vs **API 改動影響**：
- 不同的使用場景
- 不同的分析邏輯
- 不同的優先級

**實作策略**：
- 先做通用的 `/atlas impact`（功能改動）
- 再做專門的 `/atlas impact api`（API 改動）

---

## ✅ 下一步行動

### 立即開始

1. **更新 PRD.md**
   - 調整場景順序
   - 突出「學習模式」場景
   - 更新開發優先級

2. **設計 `/atlas pattern` Skill**
   - 設計 Prompt 邏輯
   - 設計 Script 輔助
   - 準備測試案例

3. **在真實專案測試**
   - 用 Mir01 專案測試
   - 驗證能否識別 Service Object 模式
   - 驗證能否提供有用的範例

---

## 📝 需要了解的問題

### 關於「學習模式」場景

1. **你最常需要學習的模式類型？**
   - [ ] API 端點（REST, GraphQL）
   - [ ] 背景任務（Jobs, Queue）
   - [ ] 資料驗證（Validation）
   - [ ] 權限控制（Authorization）
   - [ ] 檔案處理（Upload, Storage）
   - [ ] 其他？

2. **你希望得到什麼資訊？**
   - [ ] 最佳範例檔案位置
   - [ ] 標準流程步驟
   - [ ] 需要遵循的慣例
   - [ ] 常見陷阱
   - [ ] 測試模式
   - [ ] 其他？

3. **你用什麼專案測試最好？**
   - [ ] Mir01（Laravel + Next.js）
   - [ ] 你現在正在開發的專案
   - [ ] 其他專案

---

**總結**：這個優先級排序非常合理，反映了成熟開發者的思維方式。我會立即調整開發計劃，優先實作 `/atlas pattern`！
